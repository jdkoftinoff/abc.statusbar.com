<!DOCTYPE html>
<html manifest="index.manifest">
    <head>
        <title>AvbBwCalc</title>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <link rel="stylesheet" type="text/css" href="css/icons.css" />
        <link rel="stylesheet" type="text/css" href="css/af.ui.css"  />
        <link rel="apple-touch-icon" href="jdks.png">
        <style type="text/css">
.scrollable {
position: absolute;
top: 50px;
left: 0;
right: 0;
bottom: 0;
overflow: scroll;
-webkit-overflow-scrolling: touch;
}
        </style>
        <script type="text/javascript" charset="utf-8" src="ui/appframework.ui.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="avbcalc.js"></script>
        <script type="text/javascript">

if(navigator.userAgent.match(/Android/i)){
    window.scrollTo(0,1);
}

if (!((window.DocumentTouch && document instanceof DocumentTouch) || 'ontouchstart' in window)) {
    var script = document.createElement("script");
    script.src = "plugins/af.desktopBrowsers.js";
    var tag = $("head").append(script);
}


var init = function () {
        window.setTimeout(function () {
            $.ui.launch();
        }, 1500);


        var calculate = $("#calculate").get();

        calculate.onclick = function() {
            // The list of input parameters
            var input_items = [
                "network_speed_in_bps", "avb_bw", "stream_format", "sample_rate",
                "bits_per_sample", "channel_count", "aes_gcm", "samples_per_frame" ];

            // The list of output parameters
            var output_items = [
                "status", "octets_per_frame", "micros_per_frame",
                "bw_per_stream_in_bps",
                "max_stream_count_per_net_link", "total_bw_used_in_bps",
                "leftover_bw_in_bps",
                "total_channels_per_net_link",
                "ethernet_payload_length"
            ];

            // Extract the inputs from the form into one object
            var inputs = {};
            for( var i in input_items ) {
                var key=input_items[i];
                var widget = $("#input_"+key);
                var val;
                if( widget.attr("type") == "checkbox" ) {
                    if( widget.is(":checked") ) {
                        val=1;
                    } else {
                        val=0;
                    }
                } else {
                    val=widget.val();
                }

                inputs[key] = val;
            }

            // Calculate
            outputs = calculate_avb( inputs );

            // Store the outputs of the calculation into the form
            for( var i in output_items ) {
                var key=output_items[i];
                if( key ) {
                    var item = $("#output_" + key );
                    if( item && outputs[key] ) {
                        item.val( outputs[key] );
                    }
                }
            }

            $("#output_detail").text(JSON.stringify(outputs,undefined,2));
            $("#answers_button").click();

        }
};

document.addEventListener("DOMContentLoaded", init, false);


        </script>
    </head>
    <body><div id="afui"><div id="header"></div><div id="content" style="">
	<div class="panel scrollable" title="Inputs" id="page_inputs" selected="selected" data-appbuilder-object="page" style="width: 100%; min-height: 50px;">
        <div style="text-align:center;">avb.statusbar.com - 2014-01-28</div>
		<form style="width: 100%;min-height: 50px;" data-appbuilder-object="form" data-position="static" class="">
			<div class="select_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="select">
				<label for="input_network_speed_in_bps">Network Speed</label>
				<select id="input_network_speed_in_bps">
					<option value="100e6">100baseT</option>
					<option value="1e9" selected="">1 GigE</option>
					<option value="10e9">10 GigE</option>
					<option value="40e9">40 GigE</option>
				</select>
			</div>
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
                <label for="input_avb_bw">AVB BW Allocation (%)</label>
				<input type="text" style="float:left;" id="input_avb_bw" value="75">
			</div>
			<div class="select_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="select">
				<label for="input_stream_format">Stream Format</label>
				<select id="input_stream_format">
					<option value="AM824nb" selected="">AM824 (non blocking)</option>
					<option value="AM824nb-async">AM824 (non blocking, Async Packetization)</option>
					<option value="AM824b">AM824 (blocking)</option>
					<option value="AAF">AAF</option>
				</select>
			</div>
			<div class="select_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="select">
				<label for="input_sample_rate">Sample Rate</label>
				<select id="input_sample_rate">
					<option value="32000">32.0 kHz</option>
					<option value="44100">44.1 kHz</option>
					<option value="48000" selected="">48 kHz</option>
					<option value="88200">88.2 kHz</option>
					<option value="96000">96 kHz</option>
					<option value="176400">176.4 kHz</option>
					<option value="192000">192 kHz</option>
				</select>
			</div>
			<div class="select_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="select">
				<label for="input_bits_per_sample">Bits/Sample</label>
				<select id="input_bits_per_sample">
					<option value="16">16</option>
					<option value="24" selected="">24</option>
					<option value="32">32</option>
				</select>
			</div>
			<div class="select_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="select">
				<label for="input_samples_per_frame">AAF Samples/Frame</label>
				<select id="input_samples_per_frame">
					<option value="default" selected="">Default</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="6">6</option>
					<option value="12">12</option>
					<option value="24">24</option>
				</select>
			</div>
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
				<label for="input_channel_count">Channel Count</label>
				<input type="text" style="float:left;" id="input_channel_count" value="1">
			</div>
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
				<input type="checkbox" name="input_aes_gcm_checkbox" style="float:left;" id="input_aes_gcm" value="0" >
				<label for="input_aes_gcm">AES-GCM Encryption</label>
			</div>
            <div><hr></div>
		</form>
        <center><button id="calculate" style="width:50%; height:3em;">Calculate</button></center>
	</div>
	<div class="panel" title="Answers" id="page_answers" data-appbuilder-object="page" style="width: 100%; overflow: hidden;">
		<div class="container scrollable" style="width:100%" data-appbuilder-object="container" data-position="static">
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
				<label for="output_status">Status</label>
				<input type="text" style="float:left;" id="output_status" readonly >
			</div>
			<div class="input_element form_element" style="width:100%;overflow:hidden" data-appbuilder-object="input">
				<label for="output_octets_per_frame">Frame Payload Length</label>
				<input type="text" style="float:left;" id="output_ethernet_payload_length" readonly >
			</div>
			<div class="input_element form_element" style="width:100%;overflow:hidden" data-appbuilder-object="input">
				<label for="output_octets_per_frame">Octets per frame (inc. all overhead)</label>
				<input type="text" style="float:left;" id="output_octets_per_frame" readonly >
			</div>
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
				<label for="output_micros_per_frame">µs per frame</label>
				<input type="text" style="float:left;" id="output_micros_per_frame" readonly >
			</div>
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
				<label for="output_bw_per_stream_in_bps">bps used per stream</label>
				<input type="text" style="float:left;" id="output_bw_per_stream_in_bps" readonly >
			</div>
			<div class="input_element form_element" style="width:100%;overflow:hidden" data-appbuilder-object="input">
				<label for="output_max_stream_count_per_net_link">Max stream count per network link</label>
				<input type="text" style="float:left;" id="output_max_stream_count_per_net_link" readonly >
			</div>
			<div class="input_element form_element" style="width: 100%; overflow: hidden;" data-appbuilder-object="input">
				<label for="output_total_bw_used_in_bps">bps used for max stream count</label>
				<input type="text" style="float:left;" id="output_total_bw_used_in_bps" readonly >
			</div>

			<div class="input_element form_element" style="width:100%;overflow:hidden" data-appbuilder-object="input">
				<label for="output_leftover_bw_in_bps">Leftover bw in bps</label>
				<input type="text" style="float:left;" id="output_leftover_bw_in_bps" readonly >
			</div>
			<div class="input_element form_element" style="width:100%;overflow:hidden" data-appbuilder-object="input">
				<label for="output_total_channels_per_net_link">Total channels per network link</label>
				<input type="text" style="float:left;" id="output_total_channels_per_net_link" readonly >
			</div>
		</div>
	</div>
    <div class="panel" title="Details" id="page_details" data-appbuilder-object="page" style="width: 100%; overflow: hidden;">
		<div class="container scrollable" style="width:100%" data-appbuilder-object="container" data-position="static">
            <pre id="output_detail" style="width:100%;height:100%;"></pre>
        </div>
    </div>
    <div class="panel" title="Explanations" id="page_info" data-appbuilder-object="page" style="width: 100%; overflow: hidden;">
        <div class="container scrollable" style="width:100%" data-appbuilder-object="container" data-position="static">
            <h1>Information</h1>
            <p>This AVB Bandwidth Calculator is provided by Jeff Koftinoff &lt;jeff.koftinoff@gmail.com&gt;</p>
            <p>See http://avb.statusbar.com/ for more information</p>
            <h2 id="info_avb_bw">AVB BW Allocation</h2>
            <p>The AVB BW Allocation defaults to 75%.  This means that the most bandwidth that AVB Time Sensitive Streams can take is 75% of the available bandwidth of each network link.</p>
            <h2 id="info_stream_format">Stream Format</h2>
            <p>There are two stream formats that can be selected: AM824 and AAF. AM824 has the options for the talker: "non-blocking", "non-blocking (aync)", and "blocking."</p>
            <p>AM824 supports the transport of 24 bit linear audio, iec60958 encoded audio (SPDIF and AES3), SMPTE Time Code, and MIDI.</p>
            <p>Regardless of the talker's AM824 packetization, an AVB listener would be able to receive frames using AM824 non-blocking synchronous, AM824 non-blocking asynchronous, and AM824 blocking mode.</p>
            <h3>AM824 (non blocking)</h3>
            <p>The typical AVB audio device transmits using “AM824 non-blocking, synchronous” mode.  Non-Blocking means it sends one frame every observation period (125µs). Synchronous means it always sends the same number of samples per ethernet frame (6 @ 48 kHz, 12 @ 96 kHz).  </p>
            <h3>AM824 (non blocking, async packetization)</h3>
            <p>“AM824 non-blocking, asynchronous” mode means that the transmitter may send an occasional ethernet frame with one extra or one less sample due to the packetizer being asynchronous to the transmitter's observation interval.  Devices that handle more than one clock domain but have one packetizer typically use this format. Because it can send the occasional ethernet frame with 7 samples @ 48 kHz or 13 samples @ 96 kHz, it needs to reserve enough bandwidth to allow it to do so. The Apple Mac transmits AM824 non-blocking, asynchronous mode.</p>
            <h3>AM824 (blocking)</h3>
            <p>“AM824 blocking mode” is a mode that some firewire devices use, as it is easier to packetize and depacketize.  At 48 kHz, each ethernet frame always contains 8 samples. at 96 kHz, each ethernet frame always contains 16 samples. The avtp_timestamp is always for the first sample in the ethernet frame and there is always an avtp_timestamp. Because it is sending this frame every 125µs, there are some times when it doesn’t need to send any ethernet frame at all. But when it does, it is always the same size packet.  The drawback for this format is that you have to reserve bandwidth for the 8 sample frame @ 48 kHz or 16 sample frame at 96 kHz.</p>
            <h3>AAF</h3>
            <p>“AVTP Audio Format” (AAF) is a new packetization format that is defined in IEEE p1722a.  It has lower overhead than AM824, requires each ethernet frame in a stream to be the same size and format, and allows 16 bits, 24 bits at 32 bits per sample, as well as a choice on the number of samples per ethernet frame. Every ethernet frame is always the same size and format.</p>
            <h2 id="info_sample_rate">Sample Rate</h2>
            <p>All AVB stream formats can support 32 kHz, 44.1 kHz, 48 kHz, 88.2 kHz, 96 kHz, 176.4 kHz, and 192 kHz.  AAF can also support NTSC pulled rates (* 1.001 or * 1/1.001).</p>
            <h2 id="info_bits_per_sample">Bits/Sample</h2>
            <p>AM824 formats only support 24 bits per sample.  AAF formats allow packed 16 bits, 24 bits, and 32 bits per sample. For Floating point stream formats, choose 32 bits per sample.</p>
            <h2 id="info_aaf_samples_per_frame">AAF Samples/Frame</h2>
            <p>AM824 packetization allows one ethernet frame per stream per observation interval (125µs).  AAF format supports multiple ethernet frames per observation interval, allowing for more channels per stream.</p>
            <h2 id="info_channel_count">Channel Count</h2>
            <p>The channel count.</p>
            <h2 id="info_aes_gcm_encryption">AES-GCM Encryption</h2>
            <p>IEEE p1722a support AES-GCM encrypted AVB streams.  When the ethernet frame is encrypted this adds some overhead to the ethernet frame.</p>
        </div>
    </div>


</div>
            <div id="navbar">
                <a href="#page_inputs" class="icon home" id="inputs_button">Inputs</a>
                <a href="#page_answers" class="icon star" id="answers_button">Answers</a>
                <a href="#page_details" class="icon star" id="details_button">Details</a>
                <a href="#page_info" class="icon question" id="info_button">Explanations</a>
            </div>
        </div>
    </body>
</html>
